[
    {
        "id": "1e787f0d.dbabc1",
        "type": "tab",
        "label": "Greenhouse",
        "disabled": false,
        "info": ""
    },
    {
        "id": "fe9623e2.19eca",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set Daylight",
        "func": "var hour = msg.myhour\nconsole.log(hour)\n\nif(23 > hour && hour >= 16 ){\n    return {payload: 'purple'}\n} else if (16 > hour && hour >= 11 ){\n    return {payload: 'purple'}\n} else if (11 > hour && hour >= 8 ){\n    return {payload: 'purple'}\n} else \n    return {payload: 'night'}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 710,
        "y": 60,
        "wires": [
            [
                "9ee7c36f.2cec4"
            ]
        ]
    },
    {
        "id": "9ee7c36f.2cec4",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set_Colors",
        "func": "switch(msg.payload) {\n  case \"cold_white\":\n    global.set('RED',100);\n    global.set('GREEN',100);\n    global.set('BLUE',100);\n    break;\n  case \"red\":\n    global.set('RED',100);\n    global.set('GREEN',0);\n    global.set('BLUE',0);\n    break;\n  case \"blu\":\n    global.set('RED',0);\n    global.set('GREEN',0);\n    global.set('BLUE',100);\n    break;\n  case \"purple\":\n    global.set('RED',100);\n    global.set('GREEN',0);\n    global.set('BLUE',100);\n    break;\n  case \"warm_white\":\n    global.set('RED',100);\n    global.set('GREEN',100);\n    global.set('BLUE',70);\n    break;\n  case \"green\":\n    global.set('RED',0);\n    global.set('GREEN',100);\n    global.set('BLUE',0);\n    break;\n  case \"yellow\":\n    global.set('RED',100);\n    global.set('GREEN',100);\n    global.set('BLUE',0);\n    break;\n  case \"night\":\n    global.set('light_intensity',0);\n    break;\n}\nreturn {payload:1}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1010,
        "y": 220,
        "wires": [
            [
                "72fe5404.9ddbec"
            ]
        ]
    },
    {
        "id": "81b87066.215a6",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Init Light",
        "func": "global.set('RED',100);\nglobal.set('GREEN',100);\nglobal.set('BLUE',100);\nglobal.set('daylight_light_intensity',0.4)\nglobal.set('manual_light_intensity',0.4)\nglobal.set('light_mode', \"DAYLIGHT\");",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 280,
        "y": 40,
        "wires": [
            [
                "6e5f1d38.edd6c4"
            ]
        ]
    },
    {
        "id": "76bb30d4.525d7",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Init Fan",
        "func": "global.set('fan',0);\nglobal.set('fan_mode','AUTO');",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 280,
        "y": 80,
        "wires": [
            [
                "6e5f1d38.edd6c4"
            ]
        ]
    },
    {
        "id": "fbb69b4d.6d90f8",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Temp",
        "topic": "GhC/temperature",
        "qos": "0",
        "datatype": "json",
        "broker": "64d00cbd.ab4324",
        "x": 130,
        "y": 620,
        "wires": [
            [
                "c8ba5a3b.0b6de8",
                "65868744.e19858"
            ]
        ]
    },
    {
        "id": "6a979bd4.3e61f4",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Humid",
        "topic": "GhC/humidity",
        "qos": "0",
        "datatype": "json",
        "broker": "64d00cbd.ab4324",
        "x": 130,
        "y": 680,
        "wires": [
            [
                "c8ba5a3b.0b6de8",
                "ed56c99c.4b7fe8"
            ]
        ]
    },
    {
        "id": "c8ba5a3b.0b6de8",
        "type": "debug",
        "z": "1e787f0d.dbabc1",
        "name": "logger",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 660,
        "wires": []
    },
    {
        "id": "4b8fd8bd.58cf48",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "greenhouse/fan/speed",
        "payload": "0",
        "payloadType": "num",
        "x": 710,
        "y": 940,
        "wires": [
            [
                "22cf8c10.c27124"
            ]
        ]
    },
    {
        "id": "3d6966b3.be654a",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "RandomTrigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Gh/fan/random",
        "payload": "100",
        "payloadType": "num",
        "x": 370,
        "y": 1080,
        "wires": [
            [
                "b2b4e39e.259d9"
            ]
        ]
    },
    {
        "id": "1128a94f.d82967",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set Day/Night",
        "func": "var hour = msg.myhour\nconsole.log(hour)\n\nif(23 > hour && hour >= 9 ){\n    return { payload:  100, topic: 'greenhouse/fan/auto'};\n} else {\n    return { payload: 100, topic: 'greenhouse/fan/auto' };\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 860,
        "wires": [
            [
                "518530c5.88422"
            ]
        ]
    },
    {
        "id": "518530c5.88422",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set_Wind",
        "func": "if (global.get('fan_mode') == \"RANDOM\"){\n    if(msg.topic == \"greenhouse/fan/random\")\n        return msg;\n} else if (global.get('fan_mode') == \"MANUAL\"){\n    if(msg.topic == \"greenhouse/fan/speed\"\n    || msg.topic == \"Gh/fan\")\n        return msg;\n} else if (global.get('fan_mode') == \"AUTO\"){\n    if(msg.topic == \"greenhouse/fan/auto\")\n        return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1120,
        "y": 920,
        "wires": [
            [
                "b0e6a952.625c28"
            ]
        ]
    },
    {
        "id": "564055b3.a4751c",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "100%",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "greenhouse/fan/speed",
        "payload": "100",
        "payloadType": "num",
        "x": 710,
        "y": 860,
        "wires": [
            [
                "22cf8c10.c27124"
            ]
        ]
    },
    {
        "id": "b68fb562.df1808",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "70%",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "greenhouse/fan/speed",
        "payload": "70",
        "payloadType": "num",
        "x": 710,
        "y": 900,
        "wires": [
            [
                "22cf8c10.c27124"
            ]
        ]
    },
    {
        "id": "48eb14cd.16a60c",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Cold White",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "cold_white",
        "payloadType": "str",
        "x": 800,
        "y": 180,
        "wires": [
            [
                "9ee7c36f.2cec4"
            ]
        ]
    },
    {
        "id": "16f2b8e3.bb8447",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Warm White",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "warm_white",
        "payloadType": "str",
        "x": 810,
        "y": 220,
        "wires": [
            [
                "9ee7c36f.2cec4"
            ]
        ]
    },
    {
        "id": "36ba6ed2.112172",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Purple",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "purple",
        "payloadType": "str",
        "x": 790,
        "y": 260,
        "wires": [
            [
                "9ee7c36f.2cec4"
            ]
        ]
    },
    {
        "id": "b0481b20.517258",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Red",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "red",
        "payloadType": "str",
        "x": 650,
        "y": 160,
        "wires": [
            [
                "9ee7c36f.2cec4"
            ]
        ]
    },
    {
        "id": "89446c1f.e371",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Blu",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "blu",
        "payloadType": "str",
        "x": 650,
        "y": 200,
        "wires": [
            [
                "9ee7c36f.2cec4"
            ]
        ]
    },
    {
        "id": "94f8475c.536138",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Init params",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 60,
        "wires": [
            [
                "81b87066.215a6",
                "76bb30d4.525d7"
            ]
        ]
    },
    {
        "id": "d964082c.b72d48",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Yellow",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "yellow",
        "payloadType": "str",
        "x": 650,
        "y": 240,
        "wires": [
            [
                "9ee7c36f.2cec4"
            ]
        ]
    },
    {
        "id": "d594e2d3.fd9dd",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Green",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "green",
        "payloadType": "str",
        "x": 650,
        "y": 280,
        "wires": [
            [
                "9ee7c36f.2cec4"
            ]
        ]
    },
    {
        "id": "cebf961.6386f68",
        "type": "simpletime",
        "z": "1e787f0d.dbabc1",
        "name": "curr_time",
        "mydate": true,
        "myymd": true,
        "myyear": true,
        "mymonth": true,
        "mymonthn": true,
        "mydom": true,
        "mydoy": true,
        "myday": true,
        "myhourpm": true,
        "myhour": true,
        "mytime": true,
        "mytimes": true,
        "myminute": true,
        "myminutes": true,
        "mysecond": true,
        "mymillis": true,
        "myepoch": true,
        "myrawdate": true,
        "mypm": true,
        "x": 560,
        "y": 60,
        "wires": [
            [
                "fe9623e2.19eca",
                "1128a94f.d82967",
                "34a17172.cfed0e"
            ]
        ]
    },
    {
        "id": "22cf8c10.c27124",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set_Mode",
        "func": "if(msg.payload === -2)\n    global.set('fan_mode',\"RANDOM\")\nelse if (msg.payload === -1)\n    global.set('fan_mode',\"AUTO\")\nelse if (msg.payload >= 0)\n    global.set('fan_mode',\"MANUAL\")\n    \nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 870,
        "y": 920,
        "wires": [
            [
                "518530c5.88422"
            ]
        ]
    },
    {
        "id": "b2b4e39e.259d9",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Rand Wind",
        "func": "var minimum = 70;\nmsg.payload = minimum + 1 + Math.floor(Math.random() * (100 - minimum));\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 570,
        "y": 1080,
        "wires": [
            [
                "518530c5.88422"
            ]
        ]
    },
    {
        "id": "68bc3af8.3abe14",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "AUTO",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "-1",
        "payloadType": "num",
        "x": 710,
        "y": 980,
        "wires": [
            [
                "22cf8c10.c27124"
            ]
        ]
    },
    {
        "id": "b4cc6b.44317398",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "100%",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1",
        "payloadType": "str",
        "x": 810,
        "y": 340,
        "wires": [
            [
                "f1fd4ad8.f2c108"
            ]
        ]
    },
    {
        "id": "ae5d2e83.bb9ff",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "70%",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0.7",
        "payloadType": "str",
        "x": 810,
        "y": 380,
        "wires": [
            [
                "f1fd4ad8.f2c108"
            ]
        ]
    },
    {
        "id": "f1fd4ad8.f2c108",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set Light Intensity",
        "func": "global.set('manual_light_intensity',msg.payload);\nglobal.set('light_mode', \"MANUAL\");\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1050,
        "y": 480,
        "wires": [
            [
                "72fe5404.9ddbec",
                "2418aa0.8e30856"
            ]
        ]
    },
    {
        "id": "c3e710db.145bd",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "50%",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0.5",
        "payloadType": "str",
        "x": 810,
        "y": 420,
        "wires": [
            [
                "f1fd4ad8.f2c108"
            ]
        ]
    },
    {
        "id": "74d2fe54.01289",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "20%",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0.2",
        "payloadType": "str",
        "x": 810,
        "y": 460,
        "wires": [
            [
                "f1fd4ad8.f2c108"
            ]
        ]
    },
    {
        "id": "c595a319.3df6a",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set_Pump (limiter)",
        "func": "if (msg.payload >= 30) {\n    msg.payload = 30;\n}\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 970,
        "y": 680,
        "wires": [
            [
                "170023b.94353dc",
                "9b0b8b21.b33e68"
            ]
        ]
    },
    {
        "id": "7062dbb.137d924",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "greenhouse/pump/power",
        "payload": "0",
        "payloadType": "num",
        "x": 710,
        "y": 740,
        "wires": [
            [
                "c595a319.3df6a"
            ]
        ]
    },
    {
        "id": "a34a2e93.871a3",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Medium",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "greenhouse/pump/power",
        "payload": "50",
        "payloadType": "num",
        "x": 710,
        "y": 660,
        "wires": [
            [
                "c595a319.3df6a"
            ]
        ]
    },
    {
        "id": "cc5e6ed0.58217",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Low",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "greenhouse/pump/power",
        "payload": "20",
        "payloadType": "num",
        "x": 710,
        "y": 700,
        "wires": [
            [
                "c595a319.3df6a"
            ]
        ]
    },
    {
        "id": "170023b.94353dc",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Emergency Stop",
        "func": "await new Promise(r => setTimeout(r, 10000));\nmsg.payload = 0;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1120,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "e473761a.ba7aa8",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "High",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "greenhouse/pump/power",
        "payload": "100",
        "payloadType": "num",
        "x": 710,
        "y": 620,
        "wires": [
            [
                "c595a319.3df6a"
            ]
        ]
    },
    {
        "id": "9b0b8b21.b33e68",
        "type": "mqtt out",
        "z": "1e787f0d.dbabc1",
        "name": "Water Pump",
        "topic": "GhC/pump",
        "qos": "1",
        "retain": "",
        "broker": "64d00cbd.ab4324",
        "x": 1230,
        "y": 680,
        "wires": []
    },
    {
        "id": "e990e65b.589708",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Gh sensor log",
        "topic": "GhC/log",
        "qos": "0",
        "datatype": "utf8",
        "broker": "64d00cbd.ab4324",
        "x": 90,
        "y": 140,
        "wires": [
            [
                "4af1cc57.71ba44",
                "c8ba5a3b.0b6de8"
            ]
        ]
    },
    {
        "id": "b0e6a952.625c28",
        "type": "mqtt out",
        "z": "1e787f0d.dbabc1",
        "name": "FAN",
        "topic": "GhC/fan",
        "qos": "1",
        "retain": "",
        "broker": "64d00cbd.ab4324",
        "x": 1270,
        "y": 920,
        "wires": []
    },
    {
        "id": "4af1cc57.71ba44",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "init",
        "func": "if (msg.payload === 'Init GhC'){\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 270,
        "y": 140,
        "wires": [
            [
                "cebf961.6386f68"
            ]
        ]
    },
    {
        "id": "84230b87.fdbad8",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "Daylight Intensity",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "light/intensity",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 360,
        "wires": [
            [
                "d11ab25c.b9312"
            ]
        ]
    },
    {
        "id": "34a17172.cfed0e",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Compute intensity",
        "func": "var hour = msg.myhour\nif (hour < 8 || hour > 20) {\n    msg.payload = 0;\n} else {\n    if (hour <= 12){\n        msg.payload = Math.pow(hour / 12, 3);\n    } else {\n        msg.payload = Math.pow(1 - ((hour - 12) / 12), 3); \n    }\n        \n}\n// set the global value\nglobal.set('daylight_light_intensity', msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 360,
        "wires": [
            [
                "c8ba5a3b.0b6de8",
                "72fe5404.9ddbec"
            ]
        ]
    },
    {
        "id": "d11ab25c.b9312",
        "type": "simpletime",
        "z": "1e787f0d.dbabc1",
        "name": "curr_time",
        "mydate": true,
        "myymd": true,
        "myyear": true,
        "mymonth": true,
        "mymonthn": true,
        "mydom": true,
        "mydoy": true,
        "myday": true,
        "myhourpm": true,
        "myhour": true,
        "mytime": true,
        "mytimes": true,
        "myminute": true,
        "myminutes": true,
        "mysecond": true,
        "mymillis": true,
        "myepoch": true,
        "myrawdate": true,
        "mypm": true,
        "x": 380,
        "y": 360,
        "wires": [
            [
                "34a17172.cfed0e"
            ]
        ]
    },
    {
        "id": "b12eae57.5c7e7",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Light intensity",
        "topic": "Gh/light/intensity",
        "qos": "0",
        "datatype": "json",
        "broker": "64d00cbd.ab4324",
        "x": 90,
        "y": 480,
        "wires": [
            [
                "583d5996.b69008",
                "c8ba5a3b.0b6de8"
            ]
        ]
    },
    {
        "id": "583d5996.b69008",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "scale input",
        "func": "msg.payload = msg.payload / 100;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 290,
        "y": 480,
        "wires": [
            [
                "f1fd4ad8.f2c108"
            ]
        ]
    },
    {
        "id": "64a12300.13d10c",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Light Color",
        "topic": "Gh/light/color",
        "qos": "0",
        "datatype": "json",
        "broker": "64d00cbd.ab4324",
        "x": 80,
        "y": 540,
        "wires": [
            [
                "c8ba5a3b.0b6de8",
                "a6a04723.5fdc98"
            ]
        ]
    },
    {
        "id": "a6a04723.5fdc98",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set Color from RGB",
        "func": "global.set('RED', msg.payload[0]);\nglobal.set('GREEN',msg.payload[1]);\nglobal.set('BLUE',msg.payload[2]);\n\nreturn {payload:1}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 620,
        "y": 540,
        "wires": [
            [
                "72fe5404.9ddbec"
            ]
        ]
    },
    {
        "id": "ccb59236.59be1",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Pump",
        "topic": "Gh/pump",
        "qos": "0",
        "datatype": "json",
        "broker": "64d00cbd.ab4324",
        "x": 70,
        "y": 840,
        "wires": [
            [
                "c595a319.3df6a",
                "c8ba5a3b.0b6de8"
            ]
        ]
    },
    {
        "id": "cfe419c4.a7a638",
        "type": "mqtt out",
        "z": "1e787f0d.dbabc1",
        "name": "RGB",
        "topic": "GhC/light/RGB",
        "qos": "1",
        "retain": "",
        "broker": "64d00cbd.ab4324",
        "x": 1250,
        "y": 320,
        "wires": []
    },
    {
        "id": "72fe5404.9ddbec",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "@",
        "func": "var mode = global.get('light_mode');\nvar intensity = 0.0;\n\nif(mode  === 'DAYLIGHT'){\n    intensity = global.get('daylight_light_intensity');\n} else if (mode === 'MANUAL') {\n    intensity = global.get('manual_light_intensity');\n}\n\nmsg.payload = global.get('RED') * intensity + \",\" + global.get('GREEN') * intensity + \",\" + global.get('BLUE') * intensity;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1130,
        "y": 320,
        "wires": [
            [
                "cfe419c4.a7a638"
            ]
        ]
    },
    {
        "id": "e86a5120.d5472",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Moisture",
        "topic": "GhC/moisture",
        "qos": "0",
        "datatype": "json",
        "broker": "64d00cbd.ab4324",
        "x": 140,
        "y": 740,
        "wires": [
            [
                "c8ba5a3b.0b6de8"
            ]
        ]
    },
    {
        "id": "ed56c99c.4b7fe8",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Activate Fan",
        "func": "var newMsg = {};\nif(msg.payload > 90) {\n    newMsg.payload = 100;\n} else {\n    newMsg.payload = 0;\n}\nnewMsg.topic = \"greenhouse/fan/auto\";\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 940,
        "wires": [
            [
                "518530c5.88422"
            ]
        ]
    },
    {
        "id": "e5afbe31.55fce",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "RANDOM",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "-2",
        "payloadType": "num",
        "x": 720,
        "y": 1020,
        "wires": [
            [
                "22cf8c10.c27124"
            ]
        ]
    },
    {
        "id": "913c2162.51b",
        "type": "inject",
        "z": "1e787f0d.dbabc1",
        "name": "0%",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0.0",
        "payloadType": "str",
        "x": 810,
        "y": 500,
        "wires": [
            [
                "f1fd4ad8.f2c108"
            ]
        ]
    },
    {
        "id": "6e5f1d38.edd6c4",
        "type": "join",
        "z": "1e787f0d.dbabc1",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 430,
        "y": 60,
        "wires": [
            [
                "cebf961.6386f68"
            ]
        ]
    },
    {
        "id": "92206b30.1f09e8",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Fan",
        "topic": "Gh/fan",
        "qos": "0",
        "datatype": "json",
        "broker": "64d00cbd.ab4324",
        "x": 70,
        "y": 900,
        "wires": [
            [
                "518530c5.88422",
                "c8ba5a3b.0b6de8"
            ]
        ]
    },
    {
        "id": "e52f0176.da3ee",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Fan Mode",
        "topic": "Gh/fan/mode",
        "qos": "0",
        "datatype": "utf8",
        "broker": "64d00cbd.ab4324",
        "x": 80,
        "y": 960,
        "wires": [
            [
                "7b31593.3a7ada8",
                "c8ba5a3b.0b6de8"
            ]
        ]
    },
    {
        "id": "7b31593.3a7ada8",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set_Mode",
        "func": "var mode = msg.payload.toUpperCase();\n\nif(mode === \"RANDOM\" || mode === \"AUTO\" || mode === \"MANUAL\"){\n    global.set('fan_mode',mode)\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 230,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "61c345c.ffe8bbc",
        "type": "mqtt in",
        "z": "1e787f0d.dbabc1",
        "name": "Light Mode",
        "topic": "Gh/light/mode",
        "qos": "0",
        "datatype": "json",
        "broker": "64d00cbd.ab4324",
        "x": 80,
        "y": 420,
        "wires": [
            [
                "bb00fcac.59f2c"
            ]
        ]
    },
    {
        "id": "bb00fcac.59f2c",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Set_Mode",
        "func": "msg.payload = msg.payload.toUpperCase();\n\nif(msg.payload === \"DAYLIGHT\" || msg.payload === \"MANUAL\"){\n    global.set('light_mode', msg.payload)\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 250,
        "y": 420,
        "wires": [
            [
                "34a17172.cfed0e",
                "c8ba5a3b.0b6de8"
            ]
        ]
    },
    {
        "id": "2418aa0.8e30856",
        "type": "mqtt out",
        "z": "1e787f0d.dbabc1",
        "name": "Light Mode",
        "topic": "Gh/light/mode",
        "qos": "1",
        "retain": "",
        "broker": "64d00cbd.ab4324",
        "x": 1170,
        "y": 560,
        "wires": []
    },
    {
        "id": "65868744.e19858",
        "type": "function",
        "z": "1e787f0d.dbabc1",
        "name": "Emergency OFF",
        "func": "var newMsg = {};\nif(msg.payload > 38) {\n    newMsg.payload = 0;\n    global.set('manual_light_intensity', 0);\n    global.set('light_mode', \"MANUAL\");\n}\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 600,
        "wires": [
            [
                "72fe5404.9ddbec"
            ]
        ]
    },
    {
        "id": "64d00cbd.ab4324",
        "type": "mqtt-broker",
        "name": "smart Greenhouse Broker",
        "broker": "localhost",
        "port": "1881",
        "clientid": "",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    }
]
